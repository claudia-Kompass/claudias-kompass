<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GLOBAL SOUL</title>
<style>

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(180deg,#081626,#163a57);
  color:#f5f1e6;
}

.container{
  padding:40px;
  max-width:900px;
  margin:auto;
}

h1{
  font-size:48px;
  letter-spacing:3px;
  text-shadow:0 0 25px rgba(255,215,120,0.5);
}

.subtitle{
  opacity:0.7;
  margin-bottom:30px;
}

.section{
  margin-top:40px;
}

.section h2{
  color:#e6c27a;
  border-bottom:1px solid rgba(255,255,255,0.2);
  padding-bottom:8px;
}

.line{
  display:flex;
  justify-content:space-between;
  margin:10px 0;
}

.right{
  text-align:right;
}

.green{color:#46d17c;}
.red{color:#ff5e5e;}
.yellow{color:#ffd84a;}

.weatherNow{
  font-size:22px;
  margin-top:10px;
}

button{
  margin-top:20px;
  padding:10px 18px;
  border:none;
  background:#e6c27a;
  color:#081626;
  border-radius:6px;
  cursor:pointer;
}

.ampel {
  display:inline-block;
  width:10px;
  height:10px;
  border-radius:50%;
  margin-left:8px;
}

.green { background:#2ecc71; }
.red { background:#e74c3c; }
.yellow { background:#f1c40f; }

.info {
  color:#f1c40f;
  text-decoration:none;
  margin-left:8px;
}
  
</style>
</head>
<body>

<div class="container">

  <h1>üåç GLOBAL SOUL</h1>
  <div id="meta" class="subtitle"></div>

  <button onclick="loadData()">Neue Ausgabe</button>

  <div id="content"></div>

</div>

<script>

function ampel(change) {
  if (change > 1) return '<span class="ampel green"></span>';
  if (change < -1) return '<span class="ampel red"></span>';
  return '<span class="ampel yellow"></span>';
}

function weatherIcon(code) {
  if ([0].includes(code)) return "‚òÄÔ∏è";
  if ([1,2].includes(code)) return "üå§Ô∏è";
  if ([3].includes(code)) return "‚òÅÔ∏è";
  if ([45,48].includes(code)) return "üå´Ô∏è";
  if ([51,53,55,61,63,65].includes(code)) return "üåßÔ∏è";
  if ([71,73,75].includes(code)) return "‚ùÑÔ∏è";
  if ([95,96,99].includes(code)) return "‚õàÔ∏è";
  return "üå°Ô∏è";
}

function loadData() {
  fetch("/api/daily")
    .then(res => res.json())
    .then(data => {

      document.getElementById("meta").innerText =
        data.timestamp + " ¬∑ v" + data.version;

      const eurusd = parseFloat(data.markets.eurusd.value);

      const btcUSD = data.crypto.bitcoin.price;
      const btcEUR = (btcUSD / eurusd).toFixed(0);

      const nexoUSD = data.crypto.nexo.price;
      const nexoEUR = (nexoUSD / eurusd).toFixed(3);

      const icon = weatherIcon(data.weather.code);

      document.getElementById("content").innerHTML = `

        <div class="section">
          <h2>M√§rkte</h2>

          <div class="line">
            <div>DAX<br><small>${data.markets.dax.date}</small></div>
            <div class="right">
              ${data.markets.dax.value}
              <span class="ampel yellow"></span>
            </div>
          </div>

          <div class="line">
            <div>EUR/USD<br><small>${data.markets.eurusd.date}</small></div>
            <div class="right">
              ${data.markets.eurusd.value}
              <span class="ampel yellow"></span>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Krypto</h2>

          <div class="line">
            <div>Bitcoin</div>
            <div class="right">
              $${btcUSD.toLocaleString()} (‚Ç¨${btcEUR})
              ${ampel(data.crypto.bitcoin.change)}
              <a href="https://www.coingecko.com/de/coins/bitcoin" target="_blank" class="info">Info</a>
            </div>
          </div>

          <div class="line">
            <div>Nexo</div>
            <div class="right">
              $${nexoUSD.toFixed(2)} (‚Ç¨${nexoEUR})
              ${ampel(data.crypto.nexo.change)}
              <a href="https://www.coingecko.com/de/coins/nexo" target="_blank" class="info">Info</a>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Wetter ‚Äì ${data.weather.location}</h2>
          <div class="weatherNow">
            ${icon} ${data.weather.temp.toFixed(1)}¬∞C
          </div>
          <div>09:00 ${data.weather.trend.morning}¬∞C</div>
          <div>15:00 ${data.weather.trend.afternoon}¬∞C</div>
          <div>21:00 ${data.weather.trend.evening}¬∞C</div>
        </div>

      `;
    })
    .catch(err => {
      document.getElementById("content").innerHTML =
        "<p>Fehler beim Laden der Daten.</p>";
    });
}

loadData();

</script>

</body>
</html>
