<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>GLOBAL SOUL</title>

<style>
body {
  margin: 0;
  font-family: system-ui;
  background: linear-gradient(135deg,#0f1a2b,#16263f);
  color: #e8dcc0;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 40px 20px;
}

h1 {
  font-size: 40px;
  font-weight: 600;
  margin-bottom: 6px;
  letter-spacing: 2px;
}

.subtitle {
  font-size: 16px;
  opacity: 0.85;
  margin-bottom: 18px;
}

.claim-de {
  font-size: 17px;
  font-weight: 500;
  margin-bottom: 4px;
}

.claim-en {
  font-size: 13px;
  font-style: italic;
  opacity: 0.6;
  margin-bottom: 18px;
}

.meta-info {
  font-size: 14px;
  opacity: 0.7;
  margin-bottom: 40px;
}

h2 {
  font-size: 22px;
  margin-top: 40px;
  margin-bottom: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  padding-bottom: 6px;
}

.markets-line,
.crypto-line {
  font-size: 18px;
  margin: 6px 0;
}

.ampel {
  display:inline-block;
  width:12px;
  height:12px;
  border-radius:50%;
  margin-right:10px;
}

.green { background:#2ecc71; }
.red { background:#e74c3c; }
.yellow { background:#f1c40f; }

.weather-main {
  font-size: 22px;
  margin-bottom: 10px;
}

.trend-grid {
  display:flex;
  gap:40px;
  margin-top: 12px;
}

button {
  margin-top: 30px;
  padding: 12px 20px;
  background:#e8dcc0;
  border:none;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  color:#0f1a2b;
}
</style>
</head>

<body>
<div class="container">

<h1>üåç GLOBAL SOUL</h1>
<div class="subtitle">Claudia‚Äôs Daily Compass</div>

<div class="claim-de">Zwischen Heimat und Horizont.</div>
<div class="claim-en">between home and horizon</div>

<div id="metaInfo" class="meta-info"></div>
<div id="content"></div>

<button onclick="loadData()">Neue Ausgabe</button>

</div>

<script>

function cryptoAmpel(change) {
  const val = parseFloat(change);
  if (val > 1) return '<span class="ampel green"></span>';
  if (val < -1) return '<span class="ampel red"></span>';
  return '<span class="ampel yellow"></span>';
}

function marketAmpel(change) {
  const val = parseFloat(change);
  if (val > 0) return '<span class="ampel green"></span>';
  if (val < 0) return '<span class="ampel red"></span>';
  return '<span class="ampel yellow"></span>';
}

function mapWeatherIcon(code) {
  if (code === 0) return "‚òÄÔ∏è";
  if ([1,2].includes(code)) return "üå§Ô∏è";
  if ([3].includes(code)) return "‚òÅÔ∏è";
  if ([45,48].includes(code)) return "üå´Ô∏è";
  if ([51,53,55,61,63,65].includes(code)) return "üåßÔ∏è";
  if ([71,73,75].includes(code)) return "‚ùÑÔ∏è";
  if ([95,96,99].includes(code)) return "‚õàÔ∏è";
  return "üå§Ô∏è";
}

function renderTrend(t, time) {
  return `
    <div>
      <div style="opacity:0.8">${time}</div>
      <div style="font-size:22px">${mapWeatherIcon(t.code)}</div>
      <div style="font-weight:600">${Math.round(t.temp)}¬∞</div>
    </div>
  `;
}

async function loadData() {

  const res = await fetch("/api/daily");
  const data = await res.json();

  const now = new Date();
  const dateString = now.toLocaleDateString("de-DE", {
    weekday: "long",
    day: "2-digit",
    month: "2-digit",
    year: "numeric"
  });

  const timeString = now.toLocaleTimeString("de-DE", {
    hour: "2-digit",
    minute: "2-digit"
  });

  document.getElementById("metaInfo").innerHTML =
    `${dateString} ¬∑ ${timeString} Uhr ¬∑ v${data.version}`;

  document.getElementById("content").innerHTML = `

  <h2>M√§rkte</h2>

  <div class="markets-line">
    ${marketAmpel(data.markets.dax.change)}
    DAX: ${data.markets.dax.level} (${data.markets.dax.change}%)
  </div>

  <div class="markets-line">
    ${marketAmpel(data.markets.eurusd.change)}
    EUR/USD: ${data.markets.eurusd.level} (${data.markets.eurusd.change}%)
  </div>

  <h2>Krypto</h2>

  <div class="crypto-line">
    ${cryptoAmpel(data.crypto.btc.change)}
    Bitcoin: ‚Ç¨${data.crypto.btc.price} (${data.crypto.btc.change}%)
  </div>

  <div class="crypto-line">
    ${cryptoAmpel(data.crypto.nexo.change)}
    Nexo: ‚Ç¨${data.crypto.nexo.price} (${data.crypto.nexo.change}%)
  </div>

  <h2>Wetter ‚Äì ${data.weather.location}</h2>

  <div class="weather-main">
    ${mapWeatherIcon(data.weather.code)} ${data.weather.temp}¬∞C
  </div>

  <div class="trend-grid">
    ${renderTrend(data.weather.trend.morning,"09:00")}
    ${renderTrend(data.weather.trend.afternoon,"15:00")}
    ${renderTrend(data.weather.trend.evening,"21:00")}
  </div>

  `;

}

loadData();

</script>

</body>
</html>
